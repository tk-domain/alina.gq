!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/rambler-id-helper/",r(r.s=12)}([function(e,t,r){"use strict";r.d(t,"f",function(){return n}),r.d(t,"g",function(){return i}),r.d(t,"e",function(){return o}),r.d(t,"b",function(){return a}),r.d(t,"a",function(){return s}),r.d(t,"d",function(){return c}),r.d(t,"c",function(){return u}),r.d(t,"h",function(){return l});var n="ramblerIdHelper",i=n+"Raven",o="https://id.rambler.ru",a="Rambler::Id::get_profile_info",s="Rambler::Id::destroy_session",c="Rambler::Id::get_variti_url",u="Rambler::Id::Aux::get_rsidx",l=[-11,-4e3,-2e3,-2002,"api does not respond","location does not respond"]},function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"c",function(){return o}),r.d(t,"b",function(){return a});var n=["login","oauthlogin","logout"],i=function(e){return n.indexOf(e)>-1},o=function(e){return"[object Object]"===Object.prototype.toString.call(e)},a=function(e){return"function"==typeof e}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(3);function i(e){if(e.__raven__)return e;function t(){try{for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.apply(this,r)}catch(e){Object(n.a)(function(t){t.captureException(e)})}}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t.__raven__=!0,t}},function(e,t,r){"use strict";r.d(t,"a",function(){return d});var n=r(5),i=r(4),o=r(0),a=Object({NODE_ENV:"production",STAGE_ENV:"production",COMMIT:"39f80411a1b4c77510992b49a82c2da5df63a8de",VERSION:"v-0.16.1",DEPRECATE:void 0}),s=a.COMMIT,c=a.VERSION,u=a.STAGE_ENV,l=void 0;function d(e){"production"!==u&&"testing"!==u||(l?e(l):Object(i.a)(o.e+"/rambler-id-helper/raven.js?"+s,function(t){l?e(l):t||((l=window[o.g]).config(n.SENTRY_API,{logger:"helper",environment:u,release:c,tags:{git_commit:s},whitelistUrls:[/https?:\/\/id\.rambler\.ru\/rambler-id-helper\//],includePaths:[/https?:\/\/id\.rambler\.ru\/rambler-id-helper\//]}),delete window[o.g],e(l))}))}},function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=document.createElement("script");r.src=e,r.onload=function(){t(null),document.body&&document.body.removeChild(r)},r.onerror=function(e){t(e)},document.body&&document.body.appendChild(r)}r.d(t,"a",function(){return n})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EMPTY_DATE=-4000000001,t.TEST_COOKIE="checkIdCookies",t.AUTH_COUNTER_COOKIE="rcounts",t.SENTRY_API="https://06d2d05ae45943c6b93c2bd7819aa0bd@id.rambler.ru/2"},,,,,,,function(e,t,r){"use strict";function n(){return(Date.now().toString(36)+Math.random().toString(36).slice(2)).slice(0,17)}r.r(t);var i=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.name="ApiError",r&&(n.code=r.code,n.method=r.method,n.requestId=r.requestId),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}(),o=r(0);function a(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=new XMLHttpRequest,s="rid"+n(),c={method:e,params:[t],rpc:"2.0"};a.open("post",o.e+"/jsonrpc",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("X-Client-Request-Id",s),a.withCredentials=!0,a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var t=JSON.parse(a.responseText).result,n=t.status,o=t.error,c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(t,["status","error"]);"OK"!==n||null!=o?r(null!=o?new i(o.strerror,{code:o.errno,method:e,requestId:s}):new i("api failed",{code:0,method:e,requestId:s})):r(null,c)}},a.onerror=function(){r(new i("api does not respond",{code:0,method:e,requestId:s}))},a.send(JSON.stringify(c))}var s=r(4),c=r(3),u=r(2),l=r(1);var d=void 0,f=void 0;function p(e,t){var r=d,n=f,i=e||{},a=i.path,s=i.container,c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(i,["path","container"]);c.param=s instanceof HTMLElement?"embed":"iframe",c.back=window.location.href,c.iframeOrigin=window.location.origin;var u=Object.keys(c).map(function(e){var t=c[e];return(Object(l.c)(t)||Array.isArray(t))&&(t=JSON.stringify(t)),e+"="+encodeURIComponent(t)}).join("&");f=u;var p=""+o.e+(a||"/login-20/login")+"?"+u;null!=r&&(null==s||s instanceof HTMLElement&&s===r.parentElement)?n!==u?(h(r,t),r.src=p):t(r):((r=document.createElement("iframe")).src=p,r.frameBorder="0",r.style.display="block",r.style.width="100%",r.style.height="100%",d=r,h(r,t),s instanceof HTMLElement?s.setAttribute("data-id-frame","embed"):((s=document.createElement("div")).style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.right="0px",s.style.bottom="0px",s.style.zIndex="-1",s.style.transform="translateY(-200vh)",s.style.opacity="0",s.style.transition="all 500ms",s.style.overflowY="auto",s.style.webkitOverflowScrolling="touch",s.setAttribute("data-id-frame","own")),s.appendChild(r),document.body&&null==s.parentElement&&document.body.appendChild(s))}function h(e,t){e.addEventListener("load",function r(){t(e),e.removeEventListener("load",r)})}var b=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var m="39f80411a1b4c77510992b49a82c2da5df63a8de",v=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=null,this.listeners={},this.listenStorage=function(e){var t=e.data;if(Object(l.c)(t)){var n=t.emitter,i=t.eventType,a=t.frameInfo,s=t.redirectUrl,c=t.data,u=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(t,["emitter","eventType","frameInfo","redirectUrl","data"]);n===o.f&&(Object(l.a)(i)?r.emit(i,c,u):r.emit(i,a,s))}};var n=document.createElement("iframe");n.src=o.e+"/rambler-id-helper/?"+m,n.style.width="0",n.style.height="0",n.style.border="0",n.style.position="absolute",n.style.left="-9999px",n.setAttribute("aria-hidden","true"),n.onload=function(){var e={eventType:"install",emitter:o.f,data:{providerOrigin:window.location.href}};r.storage=n.contentWindow,r.storage.postMessage(e,o.e)},this.currentTabId=t,document.body&&document.body.appendChild(n),window.addEventListener("message",this.listenStorage,!1)}return b(e,[{key:"existsListener",value:function(e,t){return this.listeners[e]&&-1!==this.listeners[e].indexOf(t)}},{key:"addListener",value:function(e,t){this.listeners[e]=this.listeners[e]||[],Object(l.b)(t)&&!this.existsListener(e,t)&&this.listeners[e].push(t)}},{key:"removeListener",value:function(e,t){this.existsListener(e,t)&&this.listeners[e].splice(this.listeners[e].indexOf(t),1)}},{key:"emit",value:function(e,t,r){for(var n=arguments.length,i=Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];var s=this.storage,c=this.listeners,u=this.currentTabId;if(s&&Object(l.a)(e)){var d=Object(l.c)(r)?r.tabId:null,f=!d||d===u;if(!d){var p={emitter:o.f,eventType:e,data:t,time:Date.now(),tabId:d||u};s.postMessage(p,o.e)}var h=!!Object(l.c)(t)&&t.silentCurrentTab;if(f&&h)return}setTimeout(function(){c[e]&&c[e].forEach(function(e){e.apply(void 0,[t,r].concat(i))})},10)}}]),e}(),y=function(e,t){return function(r){t.addListener(e,r)}},O=function(e,t){return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];t.emit.apply(t,[e].concat(n))}},g=void 0;function j(e,t){if("true"!==g||e.__deprecated__)return e;function r(){var r=Date.now(),n=r;try{n=parseInt(window.localStorage.getItem(o.f+"DTime")||0,10)}catch(e){}r-n>6048e5&&Object(c.a)(function(e){e.captureMessage("deprecated "+t+" is called",{extra:{href:window.location.href}});try{window.localStorage.setItem(o.f+"DTime",r)}catch(e){}});for(var i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];return e.apply(this,a)}for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r.__deprecated__=!0,r}var w=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTabId=n(),this.emitter=new v(this.currentTabId),this.rpc=Object(u.a)(this.rpc),this.getProfileInfo=Object(u.a)(this.getProfileInfo),this.createSession=Object(u.a)(this.createSession),this.exportsid=Object(u.a)(this.exportsid),this.variti=Object(u.a)(this.variti),this.openAuth=Object(u.a)(this.openAuth),this.closeAuth=Object(u.a)(this.closeAuth),this.getCurrentUserInfo=j(Object(u.a)(this.getCurrentUserInfo),"getCurrentUserInfo"),this.addListener=Object(u.a)(this.emitter.addListener.bind(this.emitter)),this.emit=Object(u.a)(this.emitter.emit.bind(this.emitter)),this.removeListener=Object(u.a)(this.emitter.removeListener.bind(this.emitter)),this.registerOnFrameRedirect=j(Object(u.a)(y("redirect",this.emitter)),"registerOnFrameRedirect"),this.registerOnFrameCloseCallback=j(Object(u.a)(y("close",this.emitter)),"registerOnFrameCloseCallback"),this.registerOnPossibleLoginCallback=j(Object(u.a)(y("login",this.emitter)),"registerOnPossibleLoginCallback"),this.registerOnPossibleOauthLoginCallback=j(Object(u.a)(y("oauthlogin",this.emitter)),"registerOnPossibleOauthLoginCallback"),this.registerOnPossibleLogoutCallback=j(Object(u.a)(y("logout",this.emitter)),"registerOnPossibleLogoutCallback"),this.emitLogin=j(Object(u.a)(O("login",this.emitter)),"emitLogin"),this.emitLogout=j(Object(u.a)(O("logout",this.emitter)),"emitLogout")}return w(e,[{key:"onerror",value:function(e){Object(c.a)(function(t){var r=e.message,n=e.code,i=e.method,a=e.requestId;o.h.indexOf(n)>-1||o.h.indexOf(r)>-1||(i?t.captureException(e,{extra:{code:n,method:i,requestId:a}}):t.captureException(e))})}},{key:"push",value:function(e){Object(l.b)(e)&&e()}},{key:"rpc",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};a(e,t,function(e,t){e&&r.onerror(e),Object(l.b)(n)&&n(e,t)})}},{key:"logout",value:function(e,t){var r=this;Object(l.b)(e)&&(t=e,e=void 0),this.rpc(o.a,{},function(){r.emit("logout",e),Object(l.b)(t)&&t(null)})}},{key:"getProfileInfo",value:function(e,t){Object(l.b)(e)&&(t=e,e={}),this.rpc(o.b,e,function(e,r){Object(l.b)(t)&&t(r?r.profile:null)})}},{key:"getCurrentUserInfo",value:function(e){this.getProfileInfo(function(t){if(Object(l.b)(e))if(t){var r=t.display.avatar.url;/avatars\.rambler\.ru/.test(r)&&(r=r.replace(/\/default$/,"").replace(/\/get/,"/100x100"));var n={provider:t.display.avatar.provider,iconUrl:t.display.avatar.provider_icon,avatarUrl:r,shortName:t.display.short_name,displayName:t.display.display_name,mailboxExists:"general"===t.__type?1:0};e(n)}else e(null)})}},{key:"createSession",value:function(e,t){var r=this;Object(s.a)(o.e+"/script/create_session.js?token="+e,function(e){e?r.onerror(e):Object(l.b)(t)&&t()})}},{key:"exportsid",value:function(e){var t=this;Object(s.a)(o.e+"/script/exportsid.js",function(r){r?t.onerror(r):Object(l.b)(e)&&e(window.RamblerId)})}},{key:"variti",value:function(e){var t=this;this.rpc(o.d,{},function(r,n){if(n&&n.vrt_ticket){var o=n.vrt_ticket,a=o.vrtUrl,s=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(o,["vrtUrl"]);!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=new XMLHttpRequest;r.open("get",e,!0),r.onreadystatechange=function(){4===r.readyState&&0!==r.status&&t(null)},r.onerror=function(){t(new i("location does not respond"))},r.send(null)}(a,function(r){r&&t.onerror(r),e(s)})}else e()})}},{key:"getSessionToken",value:function(e){this.rpc(o.c,{},function(t,r){Object(l.b)(e)&&e(r?r.result:null)})}},{key:"openAuth",value:function(e,t){var r=this;p(e,function(e){var n=e.parentElement;if(n instanceof HTMLElement){var i=n.getAttribute("data-id-frame");r.authFrame||(r.addListener("close",function(){r.closeAuth()}),r.addListener("redirect",function(e,t){window.location.href=t})),"embed"!==i||r.authFrame||r.addListener("resize",function(e){var t=e.height;n.style.height=t+"px"}),"own"===i&&(n.style.zIndex="10000",n.style.transform="translateY(0)",n.style.opacity="1"),r.authFrame=e,Object(l.b)(t)&&t()}})}},{key:"closeAuth",value:function(e){if(this.authFrame){var t=this.authFrame.parentElement;t instanceof HTMLElement&&"own"===t.getAttribute("data-id-frame")&&(t.style.zIndex="-1",t.style.transform="translateY(-200vh)",t.style.opacity="0"),Object(l.b)(e)&&e()}}}]),e}();function E(){var e=window[o.f];Object(l.c)(e)||(window[o.f]=new _,Array.isArray(e)&&e.forEach(function(e){Object(l.b)(e)&&e()}))}r.d(t,"registerHelper",function(){return E}),document.body?E():document.addEventListener("DOMContentLoaded",E,!1)}]);
//# sourceMappingURL=auth_events.js.map?39f80411a1b4c77510992b49a82c2da5df63a8de